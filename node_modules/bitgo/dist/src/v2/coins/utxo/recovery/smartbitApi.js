"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.SmartbitApi = void 0;
const baseApi_1 = require("./baseApi");
class SmartbitApi extends baseApi_1.BaseApi {
    static forCoin(coinName) {
        switch (coinName) {
            case 'btc':
                return new SmartbitApi('https://api.smartbit.com.au/v1');
            case 'tbtc':
                return new SmartbitApi('https://testnet-api.smartbit.com.au/v1');
        }
        throw new baseApi_1.ApiNotImplementedError(coinName);
    }
    constructor(baseUrl) {
        super(baseUrl);
    }
    async getTransactionDetails(tx) {
        const path = '/blockchain/decodetx';
        const res = await this.post(path, { hex: tx.toBuffer().toString('hex') });
        /**
         * Smartbit's response when something goes wrong
         * {"success":false,"error":{"code":"REQ_ERROR","message":"TX decode failed"}}
         * we should process the error message here
         * interpret the res from smartbit
         */
        return res.map((body) => {
            if (!body.success) {
                throw new Error(body.error.message);
            }
            return body.transaction;
        });
    }
}
exports.SmartbitApi = SmartbitApi;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic21hcnRiaXRBcGkuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvdjIvY29pbnMvdXR4by9yZWNvdmVyeS9zbWFydGJpdEFwaS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFJQSx1Q0FBNEQ7QUFFNUQsTUFBYSxXQUFZLFNBQVEsaUJBQU87SUFDdEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFnQjtRQUM3QixRQUFRLFFBQVEsRUFBRTtZQUNoQixLQUFLLEtBQUs7Z0JBQ1IsT0FBTyxJQUFJLFdBQVcsQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1lBQzNELEtBQUssTUFBTTtnQkFDVCxPQUFPLElBQUksV0FBVyxDQUFDLHdDQUF3QyxDQUFDLENBQUM7U0FDcEU7UUFDRCxNQUFNLElBQUksZ0NBQXNCLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDN0MsQ0FBQztJQUVELFlBQVksT0FBZTtRQUN6QixLQUFLLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDakIsQ0FBQztJQUVELEtBQUssQ0FBQyxxQkFBcUIsQ0FBQyxFQUFpQztRQUMzRCxNQUFNLElBQUksR0FBRyxzQkFBc0IsQ0FBQztRQUNwQyxNQUFNLEdBQUcsR0FBRyxNQUFNLElBQUksQ0FBQyxJQUFJLENBQU0sSUFBSSxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRS9FOzs7OztXQUtHO1FBRUgsT0FBTyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUU7Z0JBQ2pCLE1BQU0sSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQzthQUNyQztZQUNELE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUMxQixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7Q0FDRjtBQWpDRCxrQ0FpQ0MiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBwcmV0dGllclxuICovXG5pbXBvcnQgKiBhcyB1dHhvbGliIGZyb20gJ0BiaXRnby91dHhvLWxpYic7XG5pbXBvcnQgeyBBcGlOb3RJbXBsZW1lbnRlZEVycm9yLCBCYXNlQXBpIH0gZnJvbSAnLi9iYXNlQXBpJztcblxuZXhwb3J0IGNsYXNzIFNtYXJ0Yml0QXBpIGV4dGVuZHMgQmFzZUFwaSB7XG4gIHN0YXRpYyBmb3JDb2luKGNvaW5OYW1lOiBzdHJpbmcpOiBTbWFydGJpdEFwaSB7XG4gICAgc3dpdGNoIChjb2luTmFtZSkge1xuICAgICAgY2FzZSAnYnRjJzpcbiAgICAgICAgcmV0dXJuIG5ldyBTbWFydGJpdEFwaSgnaHR0cHM6Ly9hcGkuc21hcnRiaXQuY29tLmF1L3YxJyk7XG4gICAgICBjYXNlICd0YnRjJzpcbiAgICAgICAgcmV0dXJuIG5ldyBTbWFydGJpdEFwaSgnaHR0cHM6Ly90ZXN0bmV0LWFwaS5zbWFydGJpdC5jb20uYXUvdjEnKTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEFwaU5vdEltcGxlbWVudGVkRXJyb3IoY29pbk5hbWUpO1xuICB9XG5cbiAgY29uc3RydWN0b3IoYmFzZVVybDogc3RyaW5nKSB7XG4gICAgc3VwZXIoYmFzZVVybCk7XG4gIH1cblxuICBhc3luYyBnZXRUcmFuc2FjdGlvbkRldGFpbHModHg6IHV0eG9saWIuYml0Z28uVXR4b1RyYW5zYWN0aW9uKTogUHJvbWlzZTx1bmtub3duPiB7XG4gICAgY29uc3QgcGF0aCA9ICcvYmxvY2tjaGFpbi9kZWNvZGV0eCc7XG4gICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5wb3N0PGFueT4ocGF0aCwgeyBoZXg6IHR4LnRvQnVmZmVyKCkudG9TdHJpbmcoJ2hleCcpIH0pO1xuXG4gICAgLyoqXG4gICAgICogU21hcnRiaXQncyByZXNwb25zZSB3aGVuIHNvbWV0aGluZyBnb2VzIHdyb25nXG4gICAgICoge1wic3VjY2Vzc1wiOmZhbHNlLFwiZXJyb3JcIjp7XCJjb2RlXCI6XCJSRVFfRVJST1JcIixcIm1lc3NhZ2VcIjpcIlRYIGRlY29kZSBmYWlsZWRcIn19XG4gICAgICogd2Ugc2hvdWxkIHByb2Nlc3MgdGhlIGVycm9yIG1lc3NhZ2UgaGVyZVxuICAgICAqIGludGVycHJldCB0aGUgcmVzIGZyb20gc21hcnRiaXRcbiAgICAgKi9cblxuICAgIHJldHVybiByZXMubWFwKChib2R5KSA9PiB7XG4gICAgICBpZiAoIWJvZHkuc3VjY2Vzcykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYm9keS5lcnJvci5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBib2R5LnRyYW5zYWN0aW9uO1xuICAgIH0pO1xuICB9XG59XG4iXX0=
"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AtaInitializationBuilder = void 0;
var transactionBuilder_1 = require("./transactionBuilder");
var baseCoin_1 = require("../baseCoin");
var constants_1 = require("./constants");
var utils_1 = require("./utils");
var errors_1 = require("../baseCoin/errors");
var assert_1 = __importDefault(require("assert"));
var ataInitializationTransaction_1 = require("./ataInitializationTransaction");
var AtaInitializationBuilder = /** @class */ (function (_super) {
    __extends(AtaInitializationBuilder, _super);
    function AtaInitializationBuilder(_coinConfig) {
        var _this = _super.call(this, _coinConfig) || this;
        _this._transaction = new ataInitializationTransaction_1.AtaInitializationTransaction(_coinConfig);
        return _this;
    }
    Object.defineProperty(AtaInitializationBuilder.prototype, "transactionType", {
        get: function () {
            return baseCoin_1.TransactionType.AssociatedTokenAccountInitialization;
        },
        enumerable: false,
        configurable: true
    });
    /** @inheritDoc */
    AtaInitializationBuilder.prototype.initBuilder = function (tx) {
        _super.prototype.initBuilder.call(this, tx);
        for (var _i = 0, _a = this._instructionsData; _i < _a.length; _i++) {
            var instruction = _a[_i];
            if (instruction.type === constants_1.InstructionBuilderTypes.CreateAssociatedTokenAccount) {
                var ataInitInstruction = instruction;
                this._mint = ataInitInstruction.params.mintAddress;
                this.validateMintOrThrow();
                this.sender(ataInitInstruction.params.ownerAddress);
            }
        }
    };
    /**
     * Sets the mint address of the associated token account
     *
     * @param mint mint name of associated token account
     */
    AtaInitializationBuilder.prototype.mint = function (mint) {
        var token = utils_1.getSolTokenFromTokenName(mint);
        if (!token) {
            throw new errors_1.BuildTransactionError('Invalid transaction: invalid mint, got: ' + mint);
        }
        this._mint = token.tokenAddress;
        return this;
    };
    AtaInitializationBuilder.prototype.validateMintOrThrow = function () {
        if (!this._mint || !utils_1.isValidPublicKey(this._mint)) {
            throw new errors_1.BuildTransactionError('Invalid transaction: invalid or missing mint, got: ' + this._mint);
        }
    };
    /**
     * Used to set the minimum rent exempt amount
     *
     * @param rentExemptAmount minimum rent exempt amount in lamports
     */
    AtaInitializationBuilder.prototype.rentExemptAmount = function (rentExemptAmount) {
        this._rentExemptAmount = rentExemptAmount;
        this.validateRentExemptAmountOrThrow();
        return this;
    };
    AtaInitializationBuilder.prototype.validateRentExemptAmountOrThrow = function () {
        // _rentExemptAmount is allowed to be undefined or a valid amount if it's defined
        if (this._rentExemptAmount && !utils_1.isValidAmount(this._rentExemptAmount)) {
            throw new errors_1.BuildTransactionError('Invalid transaction: invalid rentExemptAmount, got: ' + this._rentExemptAmount);
        }
    };
    /** @inheritdoc */
    AtaInitializationBuilder.prototype.validateTransaction = function (transaction) {
        _super.prototype.validateTransaction.call(this, transaction);
        this.validateMintOrThrow();
        this.validateRentExemptAmountOrThrow();
    };
    /** @inheritdoc */
    AtaInitializationBuilder.prototype.buildImplementation = function () {
        return __awaiter(this, void 0, void 0, function () {
            var ataPk, ataInitData;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        assert_1.default(this._sender, 'Sender must be set before building the transaction');
                        assert_1.default(this._mint, 'Mint must be set before building the transaction');
                        return [4 /*yield*/, utils_1.getAssociatedTokenAccountAddress(this._mint, this._sender)];
                    case 1:
                        ataPk = _a.sent();
                        ataInitData = {
                            type: constants_1.InstructionBuilderTypes.CreateAssociatedTokenAccount,
                            params: {
                                mintAddress: this._mint,
                                ataAddress: ataPk,
                                ownerAddress: this._sender,
                                payerAddress: this._sender,
                            },
                        };
                        this._instructionsData = [ataInitData];
                        this._transaction.tokenAccountRentExemptAmount = this._rentExemptAmount;
                        return [4 /*yield*/, _super.prototype.buildImplementation.call(this)];
                    case 2: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    return AtaInitializationBuilder;
}(transactionBuilder_1.TransactionBuilder));
exports.AtaInitializationBuilder = AtaInitializationBuilder;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXRhSW5pdGlhbGl6YXRpb25CdWlsZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvaW4vc29sL2F0YUluaXRpYWxpemF0aW9uQnVpbGRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyREFBMEQ7QUFDMUQsd0NBQThDO0FBSTlDLHlDQUFzRDtBQUN0RCxpQ0FBc0g7QUFDdEgsNkNBQTJEO0FBQzNELGtEQUE0QjtBQUM1QiwrRUFBOEU7QUFFOUU7SUFBOEMsNENBQWtCO0lBSzlELGtDQUFZLFdBQWlDO1FBQTdDLFlBQ0Usa0JBQU0sV0FBVyxDQUFDLFNBRW5CO1FBREMsS0FBSSxDQUFDLFlBQVksR0FBRyxJQUFJLDJEQUE0QixDQUFDLFdBQVcsQ0FBQyxDQUFDOztJQUNwRSxDQUFDO0lBRUQsc0JBQWMscURBQWU7YUFBN0I7WUFDRSxPQUFPLDBCQUFlLENBQUMsb0NBQW9DLENBQUM7UUFDOUQsQ0FBQzs7O09BQUE7SUFFRCxrQkFBa0I7SUFDbEIsOENBQVcsR0FBWCxVQUFZLEVBQWU7UUFDekIsaUJBQU0sV0FBVyxZQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRXRCLEtBQTBCLFVBQXNCLEVBQXRCLEtBQUEsSUFBSSxDQUFDLGlCQUFpQixFQUF0QixjQUFzQixFQUF0QixJQUFzQixFQUFFO1lBQTdDLElBQU0sV0FBVyxTQUFBO1lBQ3BCLElBQUksV0FBVyxDQUFDLElBQUksS0FBSyxtQ0FBdUIsQ0FBQyw0QkFBNEIsRUFBRTtnQkFDN0UsSUFBTSxrQkFBa0IsR0FBWSxXQUFXLENBQUM7Z0JBRWhELElBQUksQ0FBQyxLQUFLLEdBQUcsa0JBQWtCLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQztnQkFDbkQsSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7Z0JBQzNCLElBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDO2FBQ3JEO1NBQ0Y7SUFDSCxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILHVDQUFJLEdBQUosVUFBSyxJQUFZO1FBQ2YsSUFBTSxLQUFLLEdBQUcsZ0NBQXdCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDN0MsSUFBSSxDQUFDLEtBQUssRUFBRTtZQUNWLE1BQU0sSUFBSSw4QkFBcUIsQ0FBQywwQ0FBMEMsR0FBRyxJQUFJLENBQUMsQ0FBQztTQUNwRjtRQUNELElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDLFlBQVksQ0FBQztRQUNoQyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFTyxzREFBbUIsR0FBM0I7UUFDRSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUFDLHdCQUFnQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUNoRCxNQUFNLElBQUksOEJBQXFCLENBQUMscURBQXFELEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3JHO0lBQ0gsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxtREFBZ0IsR0FBaEIsVUFBaUIsZ0JBQXdCO1FBQ3ZDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxnQkFBZ0IsQ0FBQztRQUMxQyxJQUFJLENBQUMsK0JBQStCLEVBQUUsQ0FBQztRQUN2QyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFTyxrRUFBK0IsR0FBdkM7UUFDRSxpRkFBaUY7UUFDakYsSUFBSSxJQUFJLENBQUMsaUJBQWlCLElBQUksQ0FBQyxxQkFBYSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFO1lBQ3BFLE1BQU0sSUFBSSw4QkFBcUIsQ0FBQyxzREFBc0QsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztTQUNsSDtJQUNILENBQUM7SUFFRCxrQkFBa0I7SUFDbEIsc0RBQW1CLEdBQW5CLFVBQW9CLFdBQXlCO1FBQzNDLGlCQUFNLG1CQUFtQixZQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1FBQzNCLElBQUksQ0FBQywrQkFBK0IsRUFBRSxDQUFDO0lBQ3pDLENBQUM7SUFFRCxrQkFBa0I7SUFDRixzREFBbUIsR0FBbkM7Ozs7Ozt3QkFDRSxnQkFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsb0RBQW9ELENBQUMsQ0FBQzt3QkFDM0UsZ0JBQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLGtEQUFrRCxDQUFDLENBQUM7d0JBRXpELHFCQUFNLHdDQUFnQyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFBOzt3QkFBeEUsS0FBSyxHQUFHLFNBQWdFO3dCQUN4RSxXQUFXLEdBQVk7NEJBQzNCLElBQUksRUFBRSxtQ0FBdUIsQ0FBQyw0QkFBNEI7NEJBQzFELE1BQU0sRUFBRTtnQ0FDTixXQUFXLEVBQUUsSUFBSSxDQUFDLEtBQUs7Z0NBQ3ZCLFVBQVUsRUFBRSxLQUFLO2dDQUNqQixZQUFZLEVBQUUsSUFBSSxDQUFDLE9BQU87Z0NBQzFCLFlBQVksRUFBRSxJQUFJLENBQUMsT0FBTzs2QkFDM0I7eUJBQ0YsQ0FBQzt3QkFDRixJQUFJLENBQUMsaUJBQWlCLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQzt3QkFDdkMsSUFBSSxDQUFDLFlBQVksQ0FBQyw0QkFBNEIsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUM7d0JBQ2pFLHFCQUFNLGlCQUFNLG1CQUFtQixXQUFFLEVBQUE7NEJBQXhDLHNCQUFPLFNBQWlDLEVBQUM7Ozs7S0FDMUM7SUFDSCwrQkFBQztBQUFELENBQUMsQUE3RkQsQ0FBOEMsdUNBQWtCLEdBNkYvRDtBQTdGWSw0REFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBUcmFuc2FjdGlvbkJ1aWxkZXIgfSBmcm9tICcuL3RyYW5zYWN0aW9uQnVpbGRlcic7XG5pbXBvcnQgeyBUcmFuc2FjdGlvblR5cGUgfSBmcm9tICcuLi9iYXNlQ29pbic7XG5pbXBvcnQgeyBCYXNlQ29pbiBhcyBDb2luQ29uZmlnIH0gZnJvbSAnQGJpdGdvL3N0YXRpY3MnO1xuaW1wb3J0IHsgVHJhbnNhY3Rpb24gfSBmcm9tICcuL3RyYW5zYWN0aW9uJztcbmltcG9ydCB7IEF0YUluaXQgfSBmcm9tICcuL2lmYWNlJztcbmltcG9ydCB7IEluc3RydWN0aW9uQnVpbGRlclR5cGVzIH0gZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0IHsgZ2V0QXNzb2NpYXRlZFRva2VuQWNjb3VudEFkZHJlc3MsIGdldFNvbFRva2VuRnJvbVRva2VuTmFtZSwgaXNWYWxpZEFtb3VudCwgaXNWYWxpZFB1YmxpY0tleSB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHsgQnVpbGRUcmFuc2FjdGlvbkVycm9yIH0gZnJvbSAnLi4vYmFzZUNvaW4vZXJyb3JzJztcbmltcG9ydCBhc3NlcnQgZnJvbSAnYXNzZXJ0JztcbmltcG9ydCB7IEF0YUluaXRpYWxpemF0aW9uVHJhbnNhY3Rpb24gfSBmcm9tICcuL2F0YUluaXRpYWxpemF0aW9uVHJhbnNhY3Rpb24nO1xuXG5leHBvcnQgY2xhc3MgQXRhSW5pdGlhbGl6YXRpb25CdWlsZGVyIGV4dGVuZHMgVHJhbnNhY3Rpb25CdWlsZGVyIHtcbiAgcHJpdmF0ZSBfbWludDogc3RyaW5nO1xuICBwcml2YXRlIF9yZW50RXhlbXB0QW1vdW50OiBzdHJpbmc7XG4gIHByb3RlY3RlZCBfdHJhbnNhY3Rpb246IEF0YUluaXRpYWxpemF0aW9uVHJhbnNhY3Rpb247XG5cbiAgY29uc3RydWN0b3IoX2NvaW5Db25maWc6IFJlYWRvbmx5PENvaW5Db25maWc+KSB7XG4gICAgc3VwZXIoX2NvaW5Db25maWcpO1xuICAgIHRoaXMuX3RyYW5zYWN0aW9uID0gbmV3IEF0YUluaXRpYWxpemF0aW9uVHJhbnNhY3Rpb24oX2NvaW5Db25maWcpO1xuICB9XG5cbiAgcHJvdGVjdGVkIGdldCB0cmFuc2FjdGlvblR5cGUoKTogVHJhbnNhY3Rpb25UeXBlIHtcbiAgICByZXR1cm4gVHJhbnNhY3Rpb25UeXBlLkFzc29jaWF0ZWRUb2tlbkFjY291bnRJbml0aWFsaXphdGlvbjtcbiAgfVxuXG4gIC8qKiBAaW5oZXJpdERvYyAqL1xuICBpbml0QnVpbGRlcih0eDogVHJhbnNhY3Rpb24pOiB2b2lkIHtcbiAgICBzdXBlci5pbml0QnVpbGRlcih0eCk7XG5cbiAgICBmb3IgKGNvbnN0IGluc3RydWN0aW9uIG9mIHRoaXMuX2luc3RydWN0aW9uc0RhdGEpIHtcbiAgICAgIGlmIChpbnN0cnVjdGlvbi50eXBlID09PSBJbnN0cnVjdGlvbkJ1aWxkZXJUeXBlcy5DcmVhdGVBc3NvY2lhdGVkVG9rZW5BY2NvdW50KSB7XG4gICAgICAgIGNvbnN0IGF0YUluaXRJbnN0cnVjdGlvbjogQXRhSW5pdCA9IGluc3RydWN0aW9uO1xuXG4gICAgICAgIHRoaXMuX21pbnQgPSBhdGFJbml0SW5zdHJ1Y3Rpb24ucGFyYW1zLm1pbnRBZGRyZXNzO1xuICAgICAgICB0aGlzLnZhbGlkYXRlTWludE9yVGhyb3coKTtcbiAgICAgICAgdGhpcy5zZW5kZXIoYXRhSW5pdEluc3RydWN0aW9uLnBhcmFtcy5vd25lckFkZHJlc3MpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBtaW50IGFkZHJlc3Mgb2YgdGhlIGFzc29jaWF0ZWQgdG9rZW4gYWNjb3VudFxuICAgKlxuICAgKiBAcGFyYW0gbWludCBtaW50IG5hbWUgb2YgYXNzb2NpYXRlZCB0b2tlbiBhY2NvdW50XG4gICAqL1xuICBtaW50KG1pbnQ6IHN0cmluZyk6IHRoaXMge1xuICAgIGNvbnN0IHRva2VuID0gZ2V0U29sVG9rZW5Gcm9tVG9rZW5OYW1lKG1pbnQpO1xuICAgIGlmICghdG9rZW4pIHtcbiAgICAgIHRocm93IG5ldyBCdWlsZFRyYW5zYWN0aW9uRXJyb3IoJ0ludmFsaWQgdHJhbnNhY3Rpb246IGludmFsaWQgbWludCwgZ290OiAnICsgbWludCk7XG4gICAgfVxuICAgIHRoaXMuX21pbnQgPSB0b2tlbi50b2tlbkFkZHJlc3M7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlTWludE9yVGhyb3coKSB7XG4gICAgaWYgKCF0aGlzLl9taW50IHx8ICFpc1ZhbGlkUHVibGljS2V5KHRoaXMuX21pbnQpKSB7XG4gICAgICB0aHJvdyBuZXcgQnVpbGRUcmFuc2FjdGlvbkVycm9yKCdJbnZhbGlkIHRyYW5zYWN0aW9uOiBpbnZhbGlkIG9yIG1pc3NpbmcgbWludCwgZ290OiAnICsgdGhpcy5fbWludCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVzZWQgdG8gc2V0IHRoZSBtaW5pbXVtIHJlbnQgZXhlbXB0IGFtb3VudFxuICAgKlxuICAgKiBAcGFyYW0gcmVudEV4ZW1wdEFtb3VudCBtaW5pbXVtIHJlbnQgZXhlbXB0IGFtb3VudCBpbiBsYW1wb3J0c1xuICAgKi9cbiAgcmVudEV4ZW1wdEFtb3VudChyZW50RXhlbXB0QW1vdW50OiBzdHJpbmcpOiB0aGlzIHtcbiAgICB0aGlzLl9yZW50RXhlbXB0QW1vdW50ID0gcmVudEV4ZW1wdEFtb3VudDtcbiAgICB0aGlzLnZhbGlkYXRlUmVudEV4ZW1wdEFtb3VudE9yVGhyb3coKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHByaXZhdGUgdmFsaWRhdGVSZW50RXhlbXB0QW1vdW50T3JUaHJvdygpIHtcbiAgICAvLyBfcmVudEV4ZW1wdEFtb3VudCBpcyBhbGxvd2VkIHRvIGJlIHVuZGVmaW5lZCBvciBhIHZhbGlkIGFtb3VudCBpZiBpdCdzIGRlZmluZWRcbiAgICBpZiAodGhpcy5fcmVudEV4ZW1wdEFtb3VudCAmJiAhaXNWYWxpZEFtb3VudCh0aGlzLl9yZW50RXhlbXB0QW1vdW50KSkge1xuICAgICAgdGhyb3cgbmV3IEJ1aWxkVHJhbnNhY3Rpb25FcnJvcignSW52YWxpZCB0cmFuc2FjdGlvbjogaW52YWxpZCByZW50RXhlbXB0QW1vdW50LCBnb3Q6ICcgKyB0aGlzLl9yZW50RXhlbXB0QW1vdW50KTtcbiAgICB9XG4gIH1cblxuICAvKiogQGluaGVyaXRkb2MgKi9cbiAgdmFsaWRhdGVUcmFuc2FjdGlvbih0cmFuc2FjdGlvbj86IFRyYW5zYWN0aW9uKTogdm9pZCB7XG4gICAgc3VwZXIudmFsaWRhdGVUcmFuc2FjdGlvbih0cmFuc2FjdGlvbik7XG4gICAgdGhpcy52YWxpZGF0ZU1pbnRPclRocm93KCk7XG4gICAgdGhpcy52YWxpZGF0ZVJlbnRFeGVtcHRBbW91bnRPclRocm93KCk7XG4gIH1cblxuICAvKiogQGluaGVyaXRkb2MgKi9cbiAgcHJvdGVjdGVkIGFzeW5jIGJ1aWxkSW1wbGVtZW50YXRpb24oKTogUHJvbWlzZTxUcmFuc2FjdGlvbj4ge1xuICAgIGFzc2VydCh0aGlzLl9zZW5kZXIsICdTZW5kZXIgbXVzdCBiZSBzZXQgYmVmb3JlIGJ1aWxkaW5nIHRoZSB0cmFuc2FjdGlvbicpO1xuICAgIGFzc2VydCh0aGlzLl9taW50LCAnTWludCBtdXN0IGJlIHNldCBiZWZvcmUgYnVpbGRpbmcgdGhlIHRyYW5zYWN0aW9uJyk7XG5cbiAgICBjb25zdCBhdGFQayA9IGF3YWl0IGdldEFzc29jaWF0ZWRUb2tlbkFjY291bnRBZGRyZXNzKHRoaXMuX21pbnQsIHRoaXMuX3NlbmRlcik7XG4gICAgY29uc3QgYXRhSW5pdERhdGE6IEF0YUluaXQgPSB7XG4gICAgICB0eXBlOiBJbnN0cnVjdGlvbkJ1aWxkZXJUeXBlcy5DcmVhdGVBc3NvY2lhdGVkVG9rZW5BY2NvdW50LFxuICAgICAgcGFyYW1zOiB7XG4gICAgICAgIG1pbnRBZGRyZXNzOiB0aGlzLl9taW50LFxuICAgICAgICBhdGFBZGRyZXNzOiBhdGFQayxcbiAgICAgICAgb3duZXJBZGRyZXNzOiB0aGlzLl9zZW5kZXIsXG4gICAgICAgIHBheWVyQWRkcmVzczogdGhpcy5fc2VuZGVyLFxuICAgICAgfSxcbiAgICB9O1xuICAgIHRoaXMuX2luc3RydWN0aW9uc0RhdGEgPSBbYXRhSW5pdERhdGFdO1xuICAgIHRoaXMuX3RyYW5zYWN0aW9uLnRva2VuQWNjb3VudFJlbnRFeGVtcHRBbW91bnQgPSB0aGlzLl9yZW50RXhlbXB0QW1vdW50O1xuICAgIHJldHVybiBhd2FpdCBzdXBlci5idWlsZEltcGxlbWVudGF0aW9uKCk7XG4gIH1cbn1cbiJdfQ==